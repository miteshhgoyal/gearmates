============================================================
FILE: .\admin\src\pages\Orders.jsx
============================================================

import React, { useEffect, useState } from "react";
import axios from "axios";
import { backendUrl, currency } from "../App";
import { toast } from "react-toastify";
import {
  Package,
  User,
  Phone,
  MapPin,
  Calendar,
  CreditCard,
  Filter,
  Search,
  Download,
  Eye,
  ShoppingBag,
  TrendingUp,
  Clock,
  CheckCircle,
  XCircle,
  ChevronDown,
  ChevronUp,
  ExternalLink,
  Menu,
  X,
  MoreVertical,
  Edit,
  RefreshCw, // Added for tracking refresh
} from "lucide-react";

const Orders = ({ token }) => {
  const [orders, setOrders] = useState([]);
  const [filteredOrders, setFilteredOrders] = useState([]);
  const [loading, setLoading] = useState(false);
  const [searchTerm, setSearchTerm] = useState("");
  const [statusFilter, setStatusFilter] = useState("");
  const [paymentFilter, setPaymentFilter] = useState("");
  const [expandedOrders, setExpandedOrders] = useState(new Set());
  const [showMobileFilters, setShowMobileFilters] = useState(false);
  const [activeTab, setActiveTab] = useState("all");

  // Shiprocket tracking states
  const [trackingModal, setTrackingModal] = useState(null);
  const [trackingData, setTrackingData] = useState(null);
  const [loadingTracking, setLoadingTracking] = useState(false);

  const statusOptions = [
    "Order Placed",
    "Packing",
    "Shipped",
    "Out for delivery",
    "Delivered",
  ];

  const statusColors = {
    "Order Placed": "bg-yellow-100 text-yellow-800 border-yellow-200",
    Packing: "bg-red-100 text-red-800 border-red-200",
    Shipped: "bg-orange-100 text-orange-800 border-orange-200",
    "Out for delivery": "bg-orange-100 text-orange-800 border-orange-200",
    Delivered: "bg-green-100 text-green-800 border-green-200",
  };

  const statusIcons = {
    "Order Placed": Clock,
    Packing: Package,
    Shipped: TrendingUp,
    "Out for delivery": TrendingUp,
    Delivered: CheckCircle,
  };

  const fetchAllOrders = async () => {
    if (!token) return;

    setLoading(true);
    try {
      const response = await axios.post(
        backendUrl + "/api/order/list",
        {},
        { headers: { token } }
      );

      if (response.data.success) {
        setOrders(response.data.orders.reverse());
        setFilteredOrders(response.data.orders.reverse());
      } else {
        toast.error(response.data.message);
      }
    } catch (error) {
      toast.error("Failed to fetch orders");
    } finally {
      setLoading(false);
    }
  };

  const paymentStatusHandler = async (orderId, paymentStatus) => {
    try {
      const response = await axios.post(
        backendUrl + "/api/order/payment-status",
        { orderId, payment: paymentStatus },
        { headers: { token } }
      );

      if (response.data.success) {
        toast.success("Payment status updated");
        fetchAllOrders();
      } else {
        toast.error(response.data.message);
      }
    } catch (error) {
      console.log(error);
      toast.error("Failed to update payment status");
    }
  };

  const statusHandler = async (event, orderId) => {
    try {
      const response = await axios.post(
        backendUrl + "/api/order/status",
        { orderId, status: event.target.value },
        { headers: { token } }
      );

      if (response.data.success) {
        toast.success("Order status updated");
        fetchAllOrders();
      } else {
        toast.error(response.data.message);
      }
    } catch (error) {
      console.log(error);
      toast.error("Failed to update status");
    }
  };

  // Update tracking info manually
  const updateTrackingInfo = async (orderId, trackingInfo) => {
    try {
      const response = await axios.post(
        backendUrl + "/api/order/update-tracking",
        {
          orderId,
          awbCode: trackingInfo.awbCode,
          courierName: trackingInfo.courierName,
          trackingUrl: trackingInfo.trackingUrl,
          shiprocketOrderId: trackingInfo.shiprocketOrderId,
          shiprocketShipmentId: trackingInfo.shiprocketShipmentId,
        },
        { headers: { token } }
      );

      if (response.data.success) {
        toast.success("Tracking info updated successfully");
        fetchAllOrders();
        setTrackingModal(null);
        setTrackingData(null);
      } else {
        toast.error(response.data.message);
      }
    } catch (error) {
      console.log(error);
      toast.error("Failed to update tracking info");
    }
  };

  // Fetch tracking details from Shiprocket
  const fetchTrackingDetails = async (orderId) => {
    setLoadingTracking(true);
    try {
      const response = await axios.post(
        backendUrl + "/api/order/track",
        { orderId },
        { headers: { token } }
      );

      if (response.data.success) {
        setTrackingData(response.data.tracking);
        toast.success("Tracking data fetched");
      } else {
        toast.error(response.data.message);
      }
    } catch (error) {
      console.log(error);
      toast.error("Failed to fetch tracking details");
    } finally {
      setLoadingTracking(false);
    }
  };

  const toggleOrderExpansion = (orderId) => {
    const newExpanded = new Set(expandedOrders);
    if (newExpanded.has(orderId)) {
      newExpanded.delete(orderId);
    } else {
      newExpanded.add(orderId);
    }
    setExpandedOrders(newExpanded);
  };

  // Calculate summary stats
  const getOrderStats = () => {
    const total = filteredOrders.length;
    const delivered = filteredOrders.filter(
      (order) => order.status === "Delivered"
    ).length;
    const pending = filteredOrders.filter(
      (order) => order.status !== "Delivered"
    ).length;
    const paid = filteredOrders.filter((order) => order.payment).length;
    const totalRevenue = filteredOrders
      .filter((order) => order.payment)
      .reduce((sum, order) => sum + order.amount, 0);

    return { total, delivered, pending, paid, totalRevenue };
  };

  const stats = getOrderStats();

  // Filter orders
  useEffect(() => {
    let filtered = [...orders];

    if (searchTerm) {
      filtered = filtered.filter(
        (order) =>
          order.address.firstName
            .toLowerCase()
            .includes(searchTerm.toLowerCase()) ||
          order.address.lastName
            .toLowerCase()
            .includes(searchTerm.toLowerCase()) ||
          order.address.phone.includes(searchTerm) ||
          order._id.includes(searchTerm) ||
          order.items.some((item) =>
            item.name.toLowerCase().includes(searchTerm.toLowerCase())
          )
      );
    }

    if (statusFilter) {
      filtered = filtered.filter((order) => order.status === statusFilter);
    }

    if (paymentFilter) {
      const isPaid = paymentFilter === "paid";
      filtered = filtered.filter((order) => order.payment === isPaid);
    }

    // Tab filtering
    if (activeTab !== "all") {
      switch (activeTab) {
        case "pending":
          filtered = filtered.filter((order) => order.status !== "Delivered");
          break;
        case "delivered":
          filtered = filtered.filter((order) => order.status === "Delivered");
          break;
        case "paid":
          filtered = filtered.filter((order) => order.payment === true);
          break;
        case "unpaid":
          filtered = filtered.filter((order) => order.payment === false);
          break;
      }
    }

    setFilteredOrders(filtered);
  }, [orders, searchTerm, statusFilter, paymentFilter, activeTab]);

  useEffect(() => {
    fetchAllOrders();
  }, [token]);

  // Tracking Modal Component
  const TrackingModal = ({ order, onClose }) => {
    const [formData, setFormData] = useState({
      awbCode: order.awbCode || "",
      courierName: order.courierName || "",
      trackingUrl: order.trackingUrl || "",
      shiprocketOrderId: order.shiprocketOrderId || "",
      shiprocketShipmentId: order.shiprocketShipmentId || "",
    });

    const handleSubmit = () => {
      updateTrackingInfo(order._id, formData);
    };

    const handleFetchTracking = () => {
      fetchTrackingDetails(order._id);
    };

    return (
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50">
        <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
          <div className="sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between">
            <h3 className="text-lg font-semibold text-gray-900">
              Manage Tracking - Order #{order._id.slice(-8).toUpperCase()}
            </h3>
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-full"
            >
              <X className="w-5 h-5" />
            </button>
          </div>

          <div className="p-6 space-y-6">
            {/* Fetch from Shiprocket Button */}
            <div className="flex items-center justify-between p-4 bg-orange-50 rounded-lg">
              <div>
                <p className="font-medium text-gray-900">
                  Fetch from Shiprocket
                </p>
                <p className="text-sm text-gray-600">
                  Get latest tracking info automatically
                </p>
              </div>
              <button
                onClick={handleFetchTracking}
                disabled={loadingTracking}
                className="flex items-center space-x-2 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 disabled:opacity-50"
              >
                <RefreshCw
                  className={`w-4 h-4 ${loadingTracking ? "animate-spin" : ""}`}
                />
                <span>{loadingTracking ? "Fetching..." : "Fetch"}</span>
              </button>
            </div>

            {/* Tracking Data Display */}
            {trackingData && (
              <div className="p-4 bg-green-50 rounded-lg border border-green-200">
                <h4 className="font-semibold text-green-900 mb-3">
                  Tracking Information
                </h4>
                <div className="space-y-2 text-sm">
                  <pre className="bg-white p-3 rounded border border-green-200 overflow-x-auto">
                    {JSON.stringify(trackingData, null, 2)}
                  </pre>
                </div>
              </div>
            )}

            {/* Manual Entry Form */}
            <div className="space-y-4">
              <h4 className="font-semibold text-gray-900">
                Manual Tracking Entry
              </h4>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  AWB Code
                </label>
                <input
                  type="text"
                  value={formData.awbCode}
                  onChange={(e) =>
                    setFormData({ ...formData, awbCode: e.target.value })
                  }
                  placeholder="Enter AWB tracking number"
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Courier Name
                </label>
                <input
                  type="text"
                  value={formData.courierName}
                  onChange={(e) =>
                    setFormData({ ...formData, courierName: e.target.value })
                  }
                  placeholder="e.g., BlueDart, DTDC"
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Tracking URL
                </label>
                <input
                  type="url"
                  value={formData.trackingUrl}
                  onChange={(e) =>
                    setFormData({ ...formData, trackingUrl: e.target.value })
                  }
                  placeholder="https://tracking-url.com"
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Shiprocket Order ID
                  </label>
                  <input
                    type="text"
                    value={formData.shiprocketOrderId}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        shiprocketOrderId: e.target.value,
                      })
                    }
                    placeholder="12345678"
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Shipment ID
                  </label>
                  <input
                    type="text"
                    value={formData.shiprocketShipmentId}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        shiprocketShipmentId: e.target.value,
                      })
                    }
                    placeholder="87654321"
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"
                  />
                </div>
              </div>
            </div>

            {/* Current Values Display */}
            {(order.awbCode || order.courierName) && (
              <div className="p-4 bg-gray-50 rounded-lg">
                <h4 className="font-semibold text-gray-900 mb-3">
                  Current Tracking Info
                </h4>
                <div className="space-y-2 text-sm">
                  {order.awbCode && (
                    <p>
                      <span className="font-medium">AWB:</span> {order.awbCode}
                    </p>
                  )}
                  {order.courierName && (
                    <p>
                      <span className="font-medium">Courier:</span>{" "}
                      {order.courierName}
                    </p>
                  )}
                  {order.trackingUrl && (
                    <p>
                      <span className="font-medium">URL:</span>{" "}
                      <a
                        href={order.trackingUrl}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-orange-600 hover:underline"
                      >
                        {order.trackingUrl}
                      </a>
                    </p>
                  )}
                </div>
              </div>
            )}

            {/* Action Buttons */}
            <div className="flex items-center justify-end space-x-3 pt-4 border-t border-gray-200">
              <button
                onClick={onClose}
                className="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200"
              >
                Cancel
              </button>
              <button
                onClick={handleSubmit}
                className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700"
              >
                Update Tracking Info
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  };

  // Mobile Filter Modal
  const MobileFilterModal = () => {
    if (!showMobileFilters) return null;

    return (
      <div className="lg:hidden fixed inset-0 z-50">
        <div
          className="fixed inset-0 bg-black bg-opacity-50"
          onClick={() => setShowMobileFilters(false)}
        />
        <div className="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl max-h-[80vh] overflow-hidden">
          <div className="p-4 border-b border-gray-200">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-semibold text-gray-900">Filters</h3>
              <button
                onClick={() => setShowMobileFilters(false)}
                className="p-2 hover:bg-gray-100 rounded-full"
              >
                <X className="w-5 h-5" />
              </button>
            </div>
          </div>

          <div className="overflow-y-auto max-h-[60vh] p-4 space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Search Orders
              </label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
                <input
                  type="text"
                  placeholder="Search orders..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="pl-10 pr-4 py-3 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                />
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Order Status
              </label>
              <select
                value={statusFilter}
                onChange={(e) => setStatusFilter(e.target.value)}
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
              >
                <option value="">All Status</option>
                {statusOptions.map((status) => (
                  <option key={status} value={status}>
                    {status}
                  </option>
                ))}
              </select>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Payment Status
              </label>
              <select
                value={paymentFilter}
                onChange={(e) => setPaymentFilter(e.target.value)}
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
              >
                <option value="">All Payments</option>
                <option value="paid">Paid</option>
                <option value="pending">Pending</option>
              </select>
            </div>
          </div>

          <div className="p-4 border-t border-gray-200 bg-gray-50">
            <button
              onClick={() => setShowMobileFilters(false)}
              className="w-full bg-red-600 text-white py-3 px-4 rounded-lg font-medium"
            >
              Apply Filters ({filteredOrders.length} results)
            </button>
          </div>
        </div>
      </div>
    );
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto"></div>
          <p className="text-gray-600 mt-4">Loading orders...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Mobile Header */}
      <div className="lg:hidden bg-white border-b border-gray-200 z-40">
        <div className="px-4 py-4">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h1 className="text-xl font-semibold text-gray-900">Orders</h1>
              <p className="text-sm text-gray-600">
                {filteredOrders.length} orders
              </p>
            </div>
            <div className="flex items-center space-x-2">
              <button
                onClick={() => setShowMobileFilters(true)}
                className="flex items-center space-x-2 bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-medium"
              >
                <Filter className="w-4 h-4" />
                <span>Filter</span>
              </button>
              <button className="p-2 border border-gray-300 rounded-lg">
                <Download className="w-4 h-4 text-gray-600" />
              </button>
            </div>
          </div>

          {/* Mobile Stats Row */}
          <div className="grid grid-cols-4 gap-2 mb-4">
            <div className="bg-gray-50 p-3 rounded-lg text-center">
              <p className="text-lg font-bold text-gray-900">{stats.total}</p>
              <p className="text-xs text-gray-600">Total</p>
            </div>
            <div className="bg-green-50 p-3 rounded-lg text-center">
              <p className="text-lg font-bold text-green-700">
                {stats.delivered}
              </p>
              <p className="text-xs text-green-600">Delivered</p>
            </div>
            <div className="bg-yellow-50 p-3 rounded-lg text-center">
              <p className="text-lg font-bold text-yellow-700">
                {stats.pending}
              </p>
              <p className="text-xs text-yellow-600">Pending</p>
            </div>
            <div className="bg-orange-50 p-3 rounded-lg text-center">
              <p className="text-lg font-bold text-orange-700">
                ₹{Math.floor(stats.totalRevenue / 1000)}k
              </p>
              <p className="text-xs text-orange-600">Revenue</p>
            </div>
          </div>

          {/* Mobile Tab Navigation */}
          <div className="flex space-x-1 bg-gray-100 p-1 rounded-lg">
            {[
              { key: "all", label: "All" },
              { key: "pending", label: "Pending" },
              { key: "delivered", label: "Done" },
              { key: "paid", label: "Paid" },
            ].map(({ key, label }) => (
              <button
                key={key}
                onClick={() => setActiveTab(key)}
                className={`flex-1 py-2 px-3 text-sm font-medium rounded-md transition-colors ${
                  activeTab === key
                    ? "bg-white text-red-600 shadow-sm"
                    : "text-gray-600"
                }`}
              >
                {label}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Desktop Header */}
      <div className="hidden lg:block">
        <div className="bg-white rounded-lg shadow-sm border border-gray-200 mx-6 mt-6">
          <div className="px-6 py-4 border-b border-gray-200">
            <div className="flex items-center justify-between">
              <div>
                <h1 className="text-2xl font-semibold text-gray-900">
                  Order Management
                </h1>
                <p className="text-sm text-gray-600 mt-1">
                  Track and manage customer orders
                </p>
              </div>
            </div>
          </div>

          {/* Desktop Stats Cards */}
          <div className="px-6 py-4 border-b border-gray-200">
            <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
              <div className="bg-gray-50 p-4 rounded-lg">
                <div className="flex items-center space-x-2">
                  <ShoppingBag className="w-5 h-5 text-gray-600" />
                  <span className="text-sm text-gray-600">Total Orders</span>
                </div>
                <p className="text-2xl font-bold text-gray-900 mt-1">
                  {stats.total}
                </p>
              </div>

              <div className="bg-green-50 p-4 rounded-lg">
                <div className="flex items-center space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-600" />
                  <span className="text-sm text-green-600">Delivered</span>
                </div>
                <p className="text-2xl font-bold text-green-700 mt-1">
                  {stats.delivered}
                </p>
              </div>

              <div className="bg-yellow-50 p-4 rounded-lg">
                <div className="flex items-center space-x-2">
                  <Clock className="w-5 h-5 text-yellow-600" />
                  <span className="text-sm text-yellow-600">Pending</span>
                </div>
                <p className="text-2xl font-bold text-yellow-700 mt-1">
                  {stats.pending}
                </p>
              </div>

              <div className="bg-red-50 p-4 rounded-lg">
                <div className="flex items-center space-x-2">
                  <CreditCard className="w-5 h-5 text-red-600" />
                  <span className="text-sm text-red-600">Paid</span>
                </div>
                <p className="text-2xl font-bold text-red-700 mt-1">
                  {stats.paid}
                </p>
              </div>

              <div className="bg-orange-50 p-4 rounded-lg col-span-2 md:col-span-1">
                <div className="flex items-center space-x-2">
                  <TrendingUp className="w-5 h-5 text-orange-600" />
                  <span className="text-sm text-orange-600">Revenue</span>
                </div>
                <p className="text-2xl font-bold text-orange-700 mt-1">
                  {currency}
                  {stats.totalRevenue.toLocaleString()}
                </p>
              </div>
            </div>
          </div>

          {/* Desktop Filters */}
          <div className="px-6 py-4">
            <div className="flex flex-col md:flex-row gap-4">
              <div className="relative flex-1">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
                <input
                  type="text"
                  placeholder="Search by customer, phone, order ID, or product name..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="pl-10 pr-4 py-2 w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                />
              </div>

              <select
                value={statusFilter}
                onChange={(e) => setStatusFilter(e.target.value)}
                className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
              >
                <option value="">All Status</option>
                {statusOptions.map((status) => (
                  <option key={status} value={status}>
                    {status}
                  </option>
                ))}
              </select>

              <select
                value={paymentFilter}
                onChange={(e) => setPaymentFilter(e.target.value)}
                className="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
              >
                <option value="">All Payments</option>
                <option value="paid">Paid</option>
                <option value="pending">Pending</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      {/* Orders List */}
      <div className="px-4 lg:px-6 py-6 space-y-4">
        {filteredOrders.length === 0 ? (
          <div className="bg-white rounded-lg shadow-sm border border-gray-200 text-center py-12">
            <Package className="w-12 h-12 text-gray-400 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">
              No orders found
            </h3>
            <p className="text-gray-600">
              Try adjusting your search or filter criteria
            </p>
          </div>
        ) : (
          filteredOrders.map((order) => {
            const isExpanded = expandedOrders.has(order._id);
            const StatusIcon = statusIcons[order.status];

            return (
              <div
                key={order._id}
                className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"
              >
                {/* Mobile Order Card Header */}
                <div className="lg:hidden">
                  <div className="p-4 border-b border-gray-100">
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex-1">
                        <h3 className="text-base font-semibold text-gray-900 mb-1">
                          #{order._id.slice(-8).toUpperCase()}
                        </h3>
                        <p className="text-sm text-gray-600">
                          {order.address.firstName} {order.address.lastName}
                        </p>
                        <p className="text-xs text-gray-500 mt-1">
                          {new Date(order.date).toLocaleDateString("en-IN", {
                            year: "numeric",
                            month: "short",
                            day: "numeric",
                          })}
                        </p>
                      </div>

                      <div className="text-right">
                        <p className="text-lg font-bold text-gray-900">
                          {currency}
                          {order.amount}
                        </p>
                        <div className="flex flex-col space-y-1 mt-2">
                          <span
                            className={`px-2 py-1 rounded-full text-xs font-medium ${
                              order.payment
                                ? "bg-green-100 text-green-800"
                                : "bg-red-100 text-red-800"
                            }`}
                          >
                            {order.payment ? "Paid" : "Pending"}
                          </span>
                          <span
                            className={`px-2 py-1 rounded-full text-xs font-medium border ${
                              statusColors[order.status]
                            }`}
                          >
                            <StatusIcon className="w-3 h-3 inline mr-1" />
                            {order.status}
                          </span>
                        </div>
                      </div>
                    </div>

                    {/* Mobile Product Preview */}
                    <div className="flex items-center space-x-3 mb-3">
                      <div className="flex -space-x-2">
                        {order.items.slice(0, 3).map((item, index) => (
                          <img
                            key={index}
                            src={item.image?.[0] || "/api/placeholder/40/40"}
                            alt={item.name}
                            className="w-8 h-8 rounded-full border-2 border-white object-cover"
                            onError={(e) => {
                              e.target.src = "/api/placeholder/40/40";
                            }}
                          />
                        ))}
                        {order.items.length > 3 && (
                          <div className="w-8 h-8 rounded-full bg-gray-100 border-2 border-white flex items-center justify-center text-xs font-medium text-gray-600">
                            +{order.items.length - 3}
                          </div>
                        )}
                      </div>
                      <p className="text-sm text-gray-600">
                        {order.items.length} items
                      </p>
                    </div>

                    {/* Mobile Actions */}
                    <div className="flex items-center justify-between">
                      <div className="flex items-center space-x-2">
                        <select
                          onChange={(event) => statusHandler(event, order._id)}
                          value={order.status}
                          className="text-xs px-2 py-1 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-red-500"
                        >
                          {statusOptions.map((status) => (
                            <option key={status} value={status}>
                              {status}
                            </option>
                          ))}
                        </select>
                      </div>

                      <button
                        onClick={() => toggleOrderExpansion(order._id)}
                        className="flex items-center space-x-1 text-red-600 text-sm font-medium"
                      >
                        <span>{isExpanded ? "Less" : "More"}</span>
                        {isExpanded ? (
                          <ChevronUp className="w-4 h-4" />
                        ) : (
                          <ChevronDown className="w-4 h-4" />
                        )}
                      </button>
                    </div>
                  </div>
                </div>

                {/* Desktop Order Header */}
                <div className="hidden lg:block">
                  <div className="p-6 border-b border-gray-100">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center space-x-4">
                        <div>
                          <h3 className="text-lg font-semibold text-gray-900">
                            Order #{order._id.slice(-8).toUpperCase()}
                          </h3>
                          <div className="flex items-center space-x-4 mt-1">
                            <span className="text-sm text-gray-600">
                              {order.address.firstName} {order.address.lastName}
                            </span>
                            <span className="text-sm text-gray-400">•</span>
                            <span className="text-sm text-gray-600">
                              {new Date(order.date).toLocaleDateString(
                                "en-IN",
                                {
                                  year: "numeric",
                                  month: "short",
                                  day: "numeric",
                                }
                              )}
                            </span>
                          </div>
                        </div>
                      </div>

                      <div className="flex items-center space-x-4">
                        <div className="text-right">
                          <p className="text-lg font-bold text-gray-900">
                            {currency}
                            {order.amount}
                          </p>
                          <div className="flex items-center space-x-2">
                            <span
                              className={`px-2 py-1 rounded-full text-xs font-medium ${
                                order.payment
                                  ? "bg-green-100 text-green-800"
                                  : "bg-red-100 text-red-800"
                              }`}
                            >
                              {order.payment ? "Paid" : "Pending"}
                            </span>
                            <span
                              className={`px-3 py-1 rounded-full text-xs font-medium border ${
                                statusColors[order.status]
                              }`}
                            >
                              <StatusIcon className="w-3 h-3 inline mr-1" />
                              {order.status}
                            </span>
                          </div>
                        </div>

                        <button
                          onClick={() => toggleOrderExpansion(order._id)}
                          className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                        >
                          {isExpanded ? (
                            <ChevronUp className="w-5 h-5 text-gray-400" />
                          ) : (
                            <ChevronDown className="w-5 h-5 text-gray-400" />
                          )}
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Expanded Content */}
                {isExpanded && (
                  <div className="p-4 lg:p-6 bg-gray-50">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6">
                      {/* Products with Images */}
                      <div className="lg:col-span-2">
                        <h4 className="text-sm font-semibold text-gray-900 mb-4 flex items-center">
                          <Package className="w-4 h-4 mr-2" />
                          Ordered Items ({order.items.length})
                        </h4>
                        <div className="space-y-3">
                          {order.items.map((item, index) => (
                            <div
                              key={index}
                              className="flex items-center space-x-3 p-3 lg:p-4 bg-white rounded-lg border border-gray-200"
                            >
                              {/* Product Image */}
                              <div className="flex-shrink-0">
                                <div className="w-12 h-12 lg:w-16 lg:h-16">
                                  <img
                                    src={
                                      item.image?.[0] ||
                                      "/api/placeholder/60/60"
                                    }
                                    alt={item.name}
                                    className="w-full h-full object-cover rounded-lg border border-gray-200"
                                    onError={(e) => {
                                      e.target.src = "/api/placeholder/60/60";
                                    }}
                                  />
                                </div>
                              </div>

                              {/* Product Details */}
                              <div className="flex-1 min-w-0">
                                <h5 className="font-medium text-gray-900 text-sm lg:text-base truncate">
                                  {item.name}
                                </h5>
                                <div className="flex flex-col lg:flex-row lg:items-center lg:space-x-4 mt-1 text-xs lg:text-sm text-gray-600">
                                  <span>Qty: {item.quantity}</span>
                                  <span className="hidden lg:inline">•</span>
                                  <span className="font-medium text-gray-900">
                                    {currency}
                                    {item.price}
                                  </span>
                                  {item.category && (
                                    <>
                                      <span className="hidden lg:inline">
                                        •
                                      </span>
                                      <span className="text-red-600 text-xs bg-red-50 px-2 py-1 rounded w-fit mt-1 lg:mt-0">
                                        {item.category}
                                      </span>
                                    </>
                                  )}
                                </div>
                                {item.brand && (
                                  <p className="text-xs text-gray-500 mt-1">
                                    Brand: {item.brand}
                                  </p>
                                )}
                              </div>

                              {/* Item Total */}
                              <div className="text-right">
                                <p className="font-semibold text-gray-900 text-sm lg:text-base">
                                  {currency}
                                  {(item.price * item.quantity).toFixed(2)}
                                </p>
                              </div>
                            </div>
                          ))}
                        </div>

                        {/* Customer & Shipping Info */}
                        <div className="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                          {/* Customer Info */}
                          <div className="bg-white p-4 rounded-lg border border-gray-200">
                            <h5 className="font-semibold text-gray-900 mb-3 flex items-center">
                              <User className="w-4 h-4 mr-2" />
                              Customer Details
                            </h5>
                            <div className="space-y-2 text-sm">
                              <div className="flex items-center space-x-2">
                                <User className="w-4 h-4 text-gray-400" />
                                <span>
                                  {order.address.firstName}{" "}
                                  {order.address.lastName}
                                </span>
                              </div>
                              <div className="flex items-center space-x-2">
                                <Phone className="w-4 h-4 text-gray-400" />
                                <span>{order.address.phone}</span>
                              </div>
                              <div className="flex items-center space-x-2">
                                <CreditCard className="w-4 h-4 text-gray-400" />
                                <span className="truncate">
                                  {order.address.email}
                                </span>
                              </div>
                            </div>
                          </div>

                          {/* Shipping Address */}
                          <div className="bg-white p-4 rounded-lg border border-gray-200">
                            <h5 className="font-semibold text-gray-900 mb-3 flex items-center">
                              <MapPin className="w-4 h-4 mr-2" />
                              Shipping Address
                            </h5>
                            <div className="text-sm text-gray-700 leading-relaxed">
                              <p>{order.address.street}</p>
                              <p>
                                {order.address.city}, {order.address.state}
                              </p>
                              <p>
                                {order.address.country} -{" "}
                                {order.address.zipcode}
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Order Actions & Details */}
                      <div className="space-y-4 lg:space-y-6">
                        {/* Order Summary */}
                        <div className="bg-white p-4 rounded-lg border border-gray-200">
                          <h5 className="font-semibold text-gray-900 mb-3">
                            Order Summary
                          </h5>
                          <div className="space-y-2 text-sm">
                            <div className="flex justify-between">
                              <span className="text-gray-600">Items:</span>
                              <span>{order.items.length}</span>
                            </div>
                            <div className="flex justify-between">
                              <span className="text-gray-600">
                                Payment Method:
                              </span>
                              <span className="font-medium">
                                {order.paymentMethod}
                              </span>
                            </div>
                            <div className="flex justify-between">
                              <span className="text-gray-600">Order Date:</span>
                              <span>
                                {new Date(order.date).toLocaleDateString(
                                  "en-IN"
                                )}
                              </span>
                            </div>
                            <hr className="my-2" />
                            <div className="flex justify-between font-semibold">
                              <span>Total Amount:</span>
                              <span className="text-lg">
                                {currency}
                                {order.amount}
                              </span>
                            </div>
                          </div>
                        </div>

                        {/* Status Update */}
                        <div className="bg-white p-4 rounded-lg border border-gray-200">
                          <label className="block text-sm font-semibold text-gray-900 mb-3">
                            Update Order Status
                          </label>
                          <select
                            onChange={(event) =>
                              statusHandler(event, order._id)
                            }
                            value={order.status}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm"
                          >
                            {statusOptions.map((status) => (
                              <option key={status} value={status}>
                                {status}
                              </option>
                            ))}
                          </select>
                        </div>

                        {/* Payment Status Update */}
                        <div className="bg-white p-4 rounded-lg border border-gray-200">
                          <label className="block text-sm font-semibold text-gray-900 mb-3">
                            Update Payment Status
                          </label>
                          <select
                            onChange={(event) =>
                              paymentStatusHandler(
                                order._id,
                                event.target.value === "true"
                              )
                            }
                            value={order.payment.toString()}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 text-sm"
                          >
                            <option value="false">Unpaid</option>
                            <option value="true">Paid</option>
                          </select>
                        </div>

                        {/* Manage Tracking Button */}
                        <div className="bg-white p-4 rounded-lg border border-gray-200">
                          <button
                            onClick={() => setTrackingModal(order)}
                            className="w-full flex items-center justify-center space-x-2 bg-orange-600 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-orange-700 transition-colors"
                          >
                            <Package className="w-4 h-4" />
                            <span>Manage Tracking</span>
                          </button>

                          {/* Show tracking info if available */}
                          {(order.awbCode || order.courierName) && (
                            <div className="mt-3 pt-3 border-t border-gray-200 text-xs space-y-1">
                              {order.awbCode && (
                                <p className="text-gray-600">
                                  <span className="font-medium">AWB:</span>{" "}
                                  {order.awbCode}
                                </p>
                              )}
                              {order.courierName && (
                                <p className="text-gray-600">
                                  <span className="font-medium">Courier:</span>{" "}
                                  {order.courierName}
                                </p>
                              )}
                              {order.trackingUrl && (
                                <a
                                  href={order.trackingUrl}
                                  target="_blank"
                                  rel="noopener noreferrer"
                                  className="text-orange-600 hover:underline flex items-center space-x-1"
                                >
                                  <span>Track</span>
                                  <ExternalLink className="w-3 h-3" />
                                </a>
                              )}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            );
          })
        )}
      </div>

      {/* Mobile Filter Modal */}
      <MobileFilterModal />

      {/* Tracking Modal */}
      {trackingModal && (
        <TrackingModal
          order={trackingModal}
          onClose={() => {
            setTrackingModal(null);
            setTrackingData(null);
          }}
        />
      )}
    </div>
  );
};

export default Orders;


============================================================
FILE: .\backend\controllers\orderController.js
============================================================

import orderModel from "../models/orderModel.js";
import userModel from "../models/userModel.js";
import razorpay from 'razorpay';
import shiprocketService from '../service/shiprocketService.js';

const currency = 'inr';

const razorpayInstance = new razorpay({
    key_id: process.env.RAZORPAY_KEY_ID,
    key_secret: process.env.RAZORPAY_KEY_SECRET,
});

// Helper function
const createShiprocketOrder = async (order) => {
    try {
        const shiprocketResponse = await shiprocketService.createOrder({
            orderId: order._id.toString(),
            items: order.items,
            address: order.address,
            amount: order.amount,
            date: order.date,
            paymentMethod: order.paymentMethod
        });

        if (shiprocketResponse.order_id) {
            order.shiprocketOrderId = shiprocketResponse.order_id;
            order.shiprocketShipmentId = shiprocketResponse.shipment_id;
            await order.save();
        }

        return shiprocketResponse;
    } catch (error) {
        console.error('Shiprocket integration failed:', error);
        return null;
    }
};

const placeOrder = async (req, res) => {
    try {
        const { userId, items, amount, address } = req.body;

        const orderData = {
            userId,
            items,
            address,
            amount,
            paymentMethod: "COD",
            payment: false,
            date: Date.now()
        };

        const newOrder = new orderModel(orderData);
        await newOrder.save();

        await createShiprocketOrder(newOrder);

        await userModel.findByIdAndUpdate(userId, { cartData: {} });
        res.json({ success: true, message: "Order Placed" });

    } catch (error) {
        console.log(error);
        res.json({ success: false, message: error.message });
    }
};

const placeOrderRazorpay = async (req, res) => {
    try {
        const { userId, items, amount, address } = req.body;

        const orderData = {
            userId,
            items,
            address,
            amount,
            paymentMethod: "Razorpay",
            payment: false,
            date: Date.now()
        };

        const newOrder = new orderModel(orderData);
        await newOrder.save();

        const options = {
            amount: amount * 100,
            currency: currency.toUpperCase(),
            receipt: newOrder._id.toString()
        };

        await razorpayInstance.orders.create(options, (error, order) => {
            if (error) {
                console.log(error);
                return res.json({ success: false, message: error });
            }
            res.json({ success: true, order });
        });

    } catch (error) {
        console.log(error);
        res.json({ success: false, message: error.message });
    }
};

const verifyRazorpay = async (req, res) => {
    try {
        const { userId, razorpay_order_id } = req.body;

        const orderInfo = await razorpayInstance.orders.fetch(razorpay_order_id);

        if (orderInfo.status === 'paid') {
            const order = await orderModel.findByIdAndUpdate(
                orderInfo.receipt,
                { payment: true },
                { new: true }
            );

            await userModel.findByIdAndUpdate(userId, { cartData: {} });
            await createShiprocketOrder(order);

            res.json({ success: true, message: "Payment Successful" });
        } else {
            res.json({ success: false, message: 'Payment Failed' });
        }

    } catch (error) {
        console.log(error);
        res.json({ success: false, message: error.message });
    }
};

const allOrders = async (req, res) => {
    try {
        const orders = await orderModel.find({});
        res.json({ success: true, orders });
    } catch (error) {
        console.log(error);
        res.json({ success: false, message: error.message });
    }
};

const userOrders = async (req, res) => {
    try {
        const { userId } = req.body;
        const orders = await orderModel.find({ userId });
        res.json({ success: true, orders });
    } catch (error) {
        console.log(error);
        res.json({ success: false, message: error.message });
    }
};

const updateStatus = async (req, res) => {
    try {
        const { orderId, status } = req.body;
        await orderModel.findByIdAndUpdate(orderId, { status });
        res.json({ success: true, message: 'Status Updated' });
    } catch (error) {
        console.log(error);
        res.json({ success: false, message: error.message });
    }
};

const trackOrder = async (req, res) => {
    try {
        const { orderId } = req.body;

        const order = await orderModel.findById(orderId);

        if (!order) {
            return res.json({ success: false, message: 'Order not found' });
        }

        if (!order.shiprocketOrderId && !order.awbCode) {
            return res.json({
                success: false,
                message: 'Tracking not available yet. Order is being processed.'
            });
        }

        let trackingData = null;

        if (order.shiprocketOrderId) {
            try {
                trackingData = await shiprocketService.trackShipment(order.shiprocketOrderId);
            } catch (error) {
                console.error('Tracking by order ID failed:', error);
            }
        }

        if (!trackingData && order.awbCode) {
            try {
                trackingData = await shiprocketService.trackByAWB(order.awbCode);
            } catch (error) {
                console.error('Tracking by AWB failed:', error);
            }
        }

        res.json({
            success: true,
            tracking: trackingData,
            awbCode: order.awbCode,
            courierName: order.courierName,
            trackingUrl: order.trackingUrl,
            shiprocketOrderId: order.shiprocketOrderId,
            shiprocketShipmentId: order.shiprocketShipmentId
        });

    } catch (error) {
        console.log(error);
        res.json({ success: false, message: error.message });
    }
};

const updateTrackingInfo = async (req, res) => {
    try {
        const { orderId, awbCode, courierName, trackingUrl, shiprocketOrderId, shiprocketShipmentId } = req.body;

        const updateData = {};
        if (awbCode) updateData.awbCode = awbCode;
        if (courierName) updateData.courierName = courierName;
        if (trackingUrl) updateData.trackingUrl = trackingUrl;
        if (shiprocketOrderId) updateData.shiprocketOrderId = shiprocketOrderId;
        if (shiprocketShipmentId) updateData.shiprocketShipmentId = shiprocketShipmentId;

        await orderModel.findByIdAndUpdate(orderId, updateData);
        res.json({ success: true, message: 'Tracking info updated successfully' });

    } catch (error) {
        console.log(error);
        res.json({ success: false, message: error.message });
    }
};

const updatePaymentStatus = async (req, res) => {
    try {
        const { orderId, payment } = req.body;

        await orderModel.findByIdAndUpdate(orderId, { payment });
        res.json({ success: true, message: 'Payment status updated' });
    } catch (error) {
        console.log(error);
        res.json({ success: false, message: error.message });
    }
};

export {
    verifyRazorpay,
    placeOrder,
    placeOrderRazorpay,
    allOrders,
    userOrders,
    updateStatus,
    trackOrder,
    updateTrackingInfo,
    updatePaymentStatus 
};


============================================================
FILE: .\backend\models\orderModel.js
============================================================

import mongoose from "mongoose";

const orderSchema = new mongoose.Schema({
    userId: { type: String, required: true },
    items: { type: Array, required: true },
    amount: { type: Number, required: true },
    address: { type: Object, required: true },
    status: { type: String, required: true, default: 'Order Placed' },
    paymentMethod: { type: String, required: true },
    payment: { type: Boolean, required: true, default: false },
    date: { type: Number, required: true },

    // Shiprocket tracking fields
    shiprocketOrderId: { type: Number },
    shiprocketShipmentId: { type: Number },
    awbCode: { type: String },
    courierName: { type: String },
    trackingUrl: { type: String }
}, { timestamps: true });

const orderModel = mongoose.models.order || mongoose.model('order', orderSchema);

export default orderModel;


============================================================
FILE: .\backend\service\shiprocketService.js
============================================================

import axios from 'axios';

const SHIPROCKET_URL = process.env.SHIPROCKET_URL || 'https://apiv2.shiprocket.in/v1/external';

class ShiprocketService {
    constructor() {
        this.token = null;
        this.tokenExpiry = null;
    }

    async authenticate() {
        try {
            const response = await axios.post(`${SHIPROCKET_URL}/auth/login`, {
                email: process.env.SHIPROCKET_EMAIL,
                password: process.env.SHIPROCKET_PASSWORD
            });

            if (response.data.token) {
                this.token = response.data.token;
                this.tokenExpiry = Date.now() + (9 * 24 * 60 * 60 * 1000);
                return this.token;
            }
        } catch (error) {
            console.error('Shiprocket authentication failed:', error.response?.data || error.message);
            throw error;
        }
    }

    async getToken() {
        if (!this.token || Date.now() >= this.tokenExpiry) {
            await this.authenticate();
        }
        return this.token;
    }

    async createOrder(orderData) {
        try {
            const token = await this.getToken();

            const shiprocketOrder = {
                order_id: orderData.orderId,
                order_date: new Date(orderData.date).toISOString().split('T')[0],
                pickup_location: "Primary",
                billing_customer_name: orderData.address.firstName,
                billing_last_name: orderData.address.lastName,
                billing_address: orderData.address.street,
                billing_city: orderData.address.city,
                billing_pincode: orderData.address.zipcode,
                billing_state: orderData.address.state,
                billing_country: orderData.address.country || "India",
                billing_email: orderData.address.email,
                billing_phone: orderData.address.phone,
                shipping_is_billing: true,
                order_items: orderData.items.map(item => ({
                    name: item.name,
                    sku: item._id || item.name,
                    units: item.quantity,
                    selling_price: item.price
                })),
                payment_method: orderData.paymentMethod === 'COD' ? 'COD' : 'Prepaid',
                sub_total: orderData.amount,
                length: 10,
                breadth: 10,
                height: 10,
                weight: 0.5
            };

            const response = await axios.post(
                `${SHIPROCKET_URL}/orders/create/adhoc`,
                shiprocketOrder,
                {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                }
            );

            return response.data;
        } catch (error) {
            console.error('Shiprocket order creation failed:', error.response?.data || error.message);
            throw error;
        }
    }

    async trackShipment(shiprocketOrderId) {
        try {
            const token = await this.getToken();

            const response = await axios.get(
                `${SHIPROCKET_URL}/courier/track/shipment/${shiprocketOrderId}`,
                {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                }
            );

            return response.data;
        } catch (error) {
            console.error('Shiprocket tracking failed:', error.response?.data || error.message);
            throw error;
        }
    }

    async trackByAWB(awbCode) {
        try {
            const token = await this.getToken();

            const response = await axios.get(
                `${SHIPROCKET_URL}/courier/track/awb/${awbCode}`,
                {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                }
            );

            return response.data;
        } catch (error) {
            console.error('Shiprocket AWB tracking failed:', error.response?.data || error.message);
            throw error;
        }
    }
}

export default new ShiprocketService();


============================================================
FILE: .\frontend\src\pages\Orders.jsx
============================================================

import React, { useContext, useEffect, useState } from "react";
import { ShopContext } from "../context/ShopContext";
import Title from "../components/Title";
import axios from "axios";
import {
  Package,
  Truck,
  CheckCircle,
  Clock,
  CreditCard,
  Calendar,
  Eye,
  RotateCcw,
  MapPin,
  Phone,
  ArrowRight,
  Star,
  Filter,
  Search,
  ChevronDown,
  ChevronUp,
  ShoppingBag,
  MessageCircle,
  HelpCircle,
  RefreshCw,
  X,
  ExternalLink,
} from "lucide-react";

const Orders = () => {
  const { backendUrl, token, currency } = useContext(ShopContext);
  const [orderData, setOrderData] = useState([]);
  const [filteredOrders, setFilteredOrders] = useState([]);
  const [loading, setLoading] = useState(true);
  const [expandedOrders, setExpandedOrders] = useState(new Set());
  const [activeFilter, setActiveFilter] = useState("all");
  const [searchTerm, setSearchTerm] = useState("");

  // Shiprocket tracking states
  const [trackingModal, setTrackingModal] = useState(null);
  const [trackingLoading, setTrackingLoading] = useState(false);

  // Filter options for mobile tabs
  const filterOptions = [
    { key: "all", label: "All", count: 0 },
    { key: "pending", label: "Pending", count: 0 },
    { key: "shipped", label: "Shipped", count: 0 },
    { key: "delivered", label: "Delivered", count: 0 },
  ];

  const loadOrderData = async () => {
    try {
      if (!token) {
        setLoading(false);
        return null;
      }

      const response = await axios.post(
        backendUrl + "/api/order/userorders",
        {},
        { headers: { token } }
      );

      if (response.data.success) {
        // Process orders for tech products (no sizes)
        let allOrdersItem = [];
        response.data.orders.map((order) => {
          order.items.map((item) => {
            item["status"] = order.status;
            item["payment"] = order.payment;
            item["paymentMethod"] = order.paymentMethod;
            item["date"] = order.date;
            item["orderId"] = order._id;
            item["amount"] = order.amount;
            item["address"] = order.address;
            // Add tracking info
            item["awbCode"] = order.awbCode;
            item["courierName"] = order.courierName;
            item["trackingUrl"] = order.trackingUrl;
            item["shiprocketOrderId"] = order.shiprocketOrderId;
            item["shiprocketShipmentId"] = order.shiprocketShipmentId;
            allOrdersItem.push(item);
          });
        });
        setOrderData(allOrdersItem.reverse());
        setFilteredOrders(allOrdersItem);
      }
    } catch (error) {
      console.log(error);
    } finally {
      setLoading(false);
    }
  };

  // Track shipment
  const trackShipment = async (orderId) => {
    setTrackingLoading(true);
    try {
      const response = await axios.post(
        backendUrl + "/api/order/track",
        { orderId },
        { headers: { token } }
      );

      if (response.data.success) {
        setTrackingModal({
          orderId,
          tracking: response.data.tracking,
          awbCode: response.data.awbCode,
          courierName: response.data.courierName,
          trackingUrl: response.data.trackingUrl,
          shiprocketOrderId: response.data.shiprocketOrderId,
          shiprocketShipmentId: response.data.shiprocketShipmentId,
        });
      } else {
        alert(response.data.message || "Tracking info not available");
      }
    } catch (error) {
      console.error(error);
      alert("Failed to fetch tracking information");
    } finally {
      setTrackingLoading(false);
    }
  };

  // Filter orders based on active filter and search
  useEffect(() => {
    let filtered = [...orderData];

    // Apply status filter
    if (activeFilter !== "all") {
      switch (activeFilter) {
        case "pending":
          filtered = filtered.filter(
            (item) =>
              item.status === "Order Placed" || item.status === "Packing"
          );
          break;
        case "shipped":
          filtered = filtered.filter(
            (item) =>
              item.status === "Shipped" || item.status === "Out for delivery"
          );
          break;
        case "delivered":
          filtered = filtered.filter((item) => item.status === "Delivered");
          break;
      }
    }

    // Apply search filter
    if (searchTerm) {
      filtered = filtered.filter(
        (item) =>
          item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          item.orderId.toLowerCase().includes(searchTerm.toLowerCase()) ||
          (item.brand &&
            item.brand.toLowerCase().includes(searchTerm.toLowerCase()))
      );
    }

    setFilteredOrders(filtered);
  }, [orderData, activeFilter, searchTerm]);

  // Update filter counts
  useEffect(() => {
    filterOptions[0].count = orderData.length;
    filterOptions[1].count = orderData.filter(
      (item) => item.status === "Order Placed" || item.status === "Packing"
    ).length;
    filterOptions[2].count = orderData.filter(
      (item) => item.status === "Shipped" || item.status === "Out for delivery"
    ).length;
    filterOptions[3].count = orderData.filter(
      (item) => item.status === "Delivered"
    ).length;
  }, [orderData]);

  useEffect(() => {
    loadOrderData();
  }, [token]);

  const toggleOrderExpansion = (orderId) => {
    const newExpanded = new Set(expandedOrders);
    if (newExpanded.has(orderId)) {
      newExpanded.delete(orderId);
    } else {
      newExpanded.add(orderId);
    }
    setExpandedOrders(newExpanded);
  };

  const getStatusConfig = (status) => {
    const configs = {
      "Order Placed": {
        color: "bg-red-500",
        icon: Clock,
        bgColor: "bg-red-50",
        textColor: "text-red-700",
        progress: 20,
      },
      Packing: {
        color: "bg-yellow-500",
        icon: Package,
        bgColor: "bg-yellow-50",
        textColor: "text-yellow-700",
        progress: 40,
      },
      Shipped: {
        color: "bg-orange-500",
        icon: Truck,
        bgColor: "bg-orange-50",
        textColor: "text-orange-700",
        progress: 70,
      },
      "Out for delivery": {
        color: "bg-orange-500",
        icon: MapPin,
        bgColor: "bg-orange-50",
        textColor: "text-orange-700",
        progress: 90,
      },
      Delivered: {
        color: "bg-green-500",
        icon: CheckCircle,
        bgColor: "bg-green-50",
        textColor: "text-green-700",
        progress: 100,
      },
    };
    return configs[status] || configs["Order Placed"];
  };

  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return date.toLocaleDateString("en-IN", {
      year: "numeric",
      month: "short",
      day: "numeric",
    });
  };

  const getEstimatedDelivery = (status, orderDate) => {
    if (status === "Delivered") return "Delivered";

    const date = new Date(orderDate);
    const deliveryDate = new Date(date);
    deliveryDate.setDate(date.getDate() + 5); // 5 days from order

    return `by ${deliveryDate.toLocaleDateString("en-IN", {
      month: "short",
      day: "numeric",
    })}`;
  };

  // Tracking Modal Component
  const TrackingModal = ({ data, onClose }) => {
    return (
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50">
        <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
          <div className="sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between">
            <h3 className="text-lg font-semibold text-gray-900">
              Track Order #{data.orderId.slice(-8).toUpperCase()}
            </h3>
            <button
              onClick={onClose}
              className="p-2 hover:bg-gray-100 rounded-full"
            >
              <X className="w-5 h-5" />
            </button>
          </div>

          <div className="p-6 space-y-6">
            {/* Tracking Information */}
            {data.awbCode && (
              <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                <h4 className="font-semibold text-orange-900 mb-3">
                  Shipping Details
                </h4>
                <div className="space-y-2 text-sm">
                  <div className="flex justify-between">
                    <span className="text-gray-600">AWB Code:</span>
                    <span className="font-mono font-semibold">
                      {data.awbCode}
                    </span>
                  </div>
                  {data.courierName && (
                    <div className="flex justify-between">
                      <span className="text-gray-600">Courier:</span>
                      <span className="font-semibold">{data.courierName}</span>
                    </div>
                  )}
                  {data.trackingUrl && (
                    <div className="mt-3">
                      <a
                        href={data.trackingUrl}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="flex items-center justify-center space-x-2 bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700 transition-colors"
                      >
                        <ExternalLink className="w-4 h-4" />
                        <span>Track on Courier Website</span>
                      </a>
                    </div>
                  )}
                </div>
              </div>
            )}

            {/* Tracking Timeline */}
            {data.tracking && data.tracking.tracking_data && (
              <div>
                <h4 className="font-semibold text-gray-900 mb-4">
                  Shipment Timeline
                </h4>
                <div className="space-y-4">
                  {data.tracking.tracking_data.shipment_track.map(
                    (track, index) => (
                      <div key={index} className="flex items-start space-x-3">
                        <div className="flex-shrink-0">
                          <div
                            className={`w-3 h-3 rounded-full mt-1 ${
                              index === 0 ? "bg-orange-600" : "bg-gray-300"
                            }`}
                          ></div>
                        </div>
                        <div
                          className={`flex-1 pb-4 ${
                            index !==
                            data.tracking.tracking_data.shipment_track.length -
                              1
                              ? "border-l-2 border-gray-200"
                              : ""
                          } pl-4 -ml-1.5`}
                        >
                          <p className="font-medium text-gray-900">
                            {track.status}
                          </p>
                          <p className="text-sm text-gray-600">{track.date}</p>
                          {track.location && (
                            <p className="text-sm text-gray-500 mt-1">
                              {track.location}
                            </p>
                          )}
                        </div>
                      </div>
                    )
                  )}
                </div>
              </div>
            )}

            {/* No Tracking Available */}
            {!data.awbCode && !data.tracking && (
              <div className="text-center py-8">
                <Package className="w-12 h-12 text-gray-400 mx-auto mb-4" />
                <h3 className="text-lg font-medium text-gray-900 mb-2">
                  Tracking Not Available Yet
                </h3>
                <p className="text-gray-600">
                  Your order is being processed. Tracking information will be
                  available soon.
                </p>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Loading your orders...</p>
        </div>
      </div>
    );
  }

  if (orderData.length === 0) {
    return (
      <div className="min-h-screen bg-gray-50 p-4">
        <div className="max-w-4xl mx-auto pt-8">
          {/* Mobile Header */}
          <div className="mb-8">
            <Title text1="MY" text2="ORDERS" />
          </div>

          <div className="bg-white rounded-2xl border border-gray-200 p-8 lg:p-12 text-center">
            <div className="w-24 h-24 lg:w-32 lg:h-32 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-6">
              <ShoppingBag className="w-12 h-12 lg:w-16 lg:h-16 text-gray-300" />
            </div>

            <h3 className="text-xl lg:text-2xl font-semibold text-gray-900 mb-3">
              No orders yet
            </h3>
            <p className="text-gray-600 mb-8 max-w-md mx-auto">
              You haven't placed any orders yet. Start shopping to see your
              orders here!
            </p>

            <button
              onClick={() => (window.location.href = "/collection")}
              className="bg-red-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-red-700 transition-colors"
            >
              Start Shopping
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Mobile Header */}
      <div className="lg:hidden bg-white border-b border-gray-200 sticky top-0 z-40">
        <div className="px-4 py-4">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h1 className="text-xl font-semibold text-gray-900">My Orders</h1>
              <p className="text-sm text-gray-600">
                {filteredOrders.length} orders
              </p>
            </div>
            <div className="flex items-center space-x-2">
              <button
                onClick={loadOrderData}
                className="p-2 bg-red-600 text-white rounded-lg"
              >
                <RefreshCw className="w-4 h-4" />
              </button>
            </div>
          </div>

          {/* Mobile Filter Tabs */}
          <div className="flex space-x-1 bg-gray-100 p-1 rounded-lg overflow-x-auto">
            {filterOptions.map((option) => (
              <button
                key={option.key}
                onClick={() => setActiveFilter(option.key)}
                className={`flex-shrink-0 px-4 py-2 text-sm font-medium rounded-md transition-colors ${
                  activeFilter === option.key
                    ? "bg-white text-red-600 shadow-sm"
                    : "text-gray-600"
                }`}
              >
                {option.label} ({option.count})
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Desktop Header */}
      <div className="hidden lg:block max-w-6xl mx-auto px-4 pt-8">
        <div className="mb-8">
          <Title text1="MY" text2="ORDERS" />
          <p className="text-gray-600 mt-2">
            Track and manage your orders ({filteredOrders.length} items)
          </p>
        </div>

        {/* Desktop Filters */}
        <div className="bg-white rounded-lg border border-gray-200 p-4 mb-6">
          <div className="flex items-center justify-between">
            <div className="flex space-x-1">
              {filterOptions.map((option) => (
                <button
                  key={option.key}
                  onClick={() => setActiveFilter(option.key)}
                  className={`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${
                    activeFilter === option.key
                      ? "bg-red-100 text-red-700"
                      : "text-gray-600 hover:text-gray-900"
                  }`}
                >
                  {option.label} ({option.count})
                </button>
              ))}
            </div>

            <div className="flex items-center space-x-4">
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
                <input
                  type="text"
                  placeholder="Search orders..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-sm w-64"
                />
              </div>
              <button
                onClick={loadOrderData}
                className="flex items-center space-x-2 bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-700 transition-colors"
              >
                <RefreshCw className="w-4 h-4" />
                <span>Refresh</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* Orders List */}
      <div className="px-4 lg:px-0 lg:max-w-6xl lg:mx-auto pb-6 space-y-4">
        {filteredOrders.length === 0 ? (
          <div className="bg-white rounded-lg border border-gray-200 p-12 text-center">
            <Package className="w-12 h-12 text-gray-400 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">
              No orders found
            </h3>
            <p className="text-gray-600">
              Try adjusting your filters or search terms
            </p>
          </div>
        ) : (
          filteredOrders.map((item, index) => {
            const isExpanded = expandedOrders.has(item.orderId + index);
            const statusConfig = getStatusConfig(item.status);
            const StatusIcon = statusConfig.icon;

            return (
              <div
                key={index}
                className="bg-white rounded-lg lg:rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow"
              >
                {/* Mobile Order Card */}
                <div className="lg:hidden">
                  <div className="p-4">
                    {/* Order Header */}
                    <div className="flex items-start space-x-3 mb-4">
                      <div className="flex-shrink-0">
                        <img
                          className="w-16 h-16 object-cover rounded-lg border border-gray-200"
                          src={item.image[0]}
                          alt={item.name}
                          onError={(e) => {
                            e.target.src = "/api/placeholder/64/64";
                          }}
                        />
                        {item.bestseller && (
                          <div className="absolute -mt-14 -ml-1">
                            <Star className="w-4 h-4 text-yellow-400 fill-current" />
                          </div>
                        )}
                      </div>

                      <div className="flex-1 min-w-0">
                        <h3 className="font-semibold text-gray-900 text-sm line-clamp-2 mb-1">
                          {item.name}
                        </h3>

                        <div className="flex items-center justify-between mb-2">
                          <div className="text-sm text-gray-600">
                            <span className="font-semibold text-gray-900">
                              {currency}
                              {item.price}
                            </span>
                            <span className="ml-2">× {item.quantity}</span>
                          </div>

                          <div
                            className={`px-2 py-1 rounded-full text-xs font-medium ${statusConfig.bgColor} ${statusConfig.textColor}`}
                          >
                            <StatusIcon className="w-3 h-3 inline mr-1" />
                            {item.status}
                          </div>
                        </div>

                        <div className="flex items-center justify-between text-xs text-gray-500">
                          <span>#{item.orderId?.slice(-8).toUpperCase()}</span>
                          <span>{formatDate(item.date)}</span>
                        </div>
                      </div>
                    </div>

                    {/* Progress Bar */}
                    {item.status !== "Delivered" && (
                      <div className="mb-4">
                        <div className="flex justify-between text-xs text-gray-500 mb-1">
                          <span>Order Progress</span>
                          <span>{statusConfig.progress}%</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                          <div
                            className={`h-2 rounded-full transition-all duration-300 ${statusConfig.color}`}
                            style={{ width: `${statusConfig.progress}%` }}
                          />
                        </div>
                      </div>
                    )}

                    {/* Action Buttons */}
                    <div className="space-y-2 mb-3">
                      <button
                        onClick={() => trackShipment(item.orderId)}
                        disabled={trackingLoading}
                        className="w-full flex items-center justify-center space-x-2 bg-red-600 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-red-700 transition-colors disabled:opacity-50"
                      >
                        {trackingLoading ? (
                          <>
                            <RefreshCw className="w-4 h-4 animate-spin" />
                            <span>Loading...</span>
                          </>
                        ) : (
                          <>
                            <RotateCcw className="w-4 h-4" />
                            <span>Track Order</span>
                          </>
                        )}
                      </button>

                      {/* Show tracking info if available */}
                      {item.awbCode && (
                        <div className="text-xs text-gray-600 bg-orange-50 p-2 rounded">
                          <p>
                            <span className="font-medium">AWB:</span>{" "}
                            {item.awbCode}
                          </p>
                          {item.courierName && (
                            <p>
                              <span className="font-medium">Courier:</span>{" "}
                              {item.courierName}
                            </p>
                          )}
                        </div>
                      )}
                    </div>

                    <div className="flex items-center justify-between">
                      <div className="text-sm">
                        <span className="text-gray-600">Delivery: </span>
                        <span className="font-medium text-gray-900">
                          {getEstimatedDelivery(item.status, item.date)}
                        </span>
                      </div>

                      <button
                        onClick={() =>
                          toggleOrderExpansion(item.orderId + index)
                        }
                        className="flex items-center space-x-1 text-red-600 text-sm font-medium"
                      >
                        <span>{isExpanded ? "Less" : "More"}</span>
                        {isExpanded ? (
                          <ChevronUp className="w-4 h-4" />
                        ) : (
                          <ChevronDown className="w-4 h-4" />
                        )}
                      </button>
                    </div>

                    {/* Expanded Details */}
                    {isExpanded && (
                      <div className="mt-4 pt-4 border-t border-gray-200 space-y-4">
                        {/* Order Details */}
                        <div className="grid grid-cols-2 gap-4 text-sm">
                          <div>
                            <p className="text-gray-600 mb-1">Payment</p>
                            <div className="flex items-center space-x-2">
                              <span>
                                {item.paymentMethod === "COD" ? "💵" : "💳"}
                              </span>
                              <span className="font-medium">
                                {item.paymentMethod}
                              </span>
                              <span
                                className={`px-2 py-1 rounded-full text-xs font-medium ${
                                  item.payment
                                    ? "bg-green-100 text-green-800"
                                    : "bg-red-100 text-red-800"
                                }`}
                              >
                                {item.payment ? "Paid" : "Pending"}
                              </span>
                            </div>
                          </div>

                          <div>
                            <p className="text-gray-600 mb-1">Total</p>
                            <p className="font-semibold text-gray-900">
                              {currency}
                              {(item.price * item.quantity).toFixed(2)}
                            </p>
                          </div>
                        </div>

                        {/* Shipping Address */}
                        {item.address && (
                          <div>
                            <p className="text-gray-600 mb-2 text-sm">
                              Shipping Address
                            </p>
                            <div className="bg-gray-50 p-3 rounded-lg text-sm">
                              <p className="font-medium text-gray-900">
                                {item.address.firstName} {item.address.lastName}
                              </p>
                              <p className="text-gray-600">
                                {item.address.city}, {item.address.state}
                              </p>
                              <div className="flex items-center space-x-1 mt-1 text-gray-600">
                                <Phone className="w-3 h-3" />
                                <span>{item.address.phone}</span>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                </div>

                {/* Desktop Order Card */}
                <div className="hidden lg:block p-6">
                  <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    {/* Product Info */}
                    <div className="lg:col-span-2">
                      <div className="flex items-start space-x-4">
                        {/* Product Image */}
                        <div className="flex-shrink-0 relative">
                          <img
                            className="w-20 h-20 object-cover rounded-lg border border-gray-200"
                            src={item.image[0]}
                            alt={item.name}
                            onError={(e) => {
                              e.target.src = "/api/placeholder/80/80";
                            }}
                          />
                          {item.bestseller && (
                            <div className="absolute -top-2 -right-2 bg-yellow-400 text-black text-xs font-bold px-2 py-1 rounded-full">
                              ★
                            </div>
                          )}
                        </div>

                        {/* Product Details */}
                        <div className="flex-grow min-w-0">
                          <h3 className="font-semibold text-gray-900 mb-1 truncate">
                            {item.name}
                          </h3>
                          {item.brand && (
                            <p className="text-sm text-red-600 mb-2">
                              {item.brand}
                            </p>
                          )}

                          <div className="space-y-1 text-sm text-gray-600">
                            <div className="flex items-center space-x-4">
                              <span className="font-medium text-gray-900">
                                {currency}
                                {item.price}
                              </span>
                              <span>Qty: {item.quantity}</span>
                            </div>
                            {item.warranty && <p>Warranty: {item.warranty}</p>}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Order Details */}
                    <div className="space-y-3">
                      <div>
                        <p className="text-sm text-gray-500 mb-1">Order ID</p>
                        <p className="text-sm font-mono text-gray-900">
                          #{item.orderId?.slice(-8).toUpperCase()}
                        </p>
                      </div>

                      <div className="flex items-center space-x-2 text-sm text-gray-600">
                        <Calendar className="w-4 h-4" />
                        <span>{formatDate(item.date)}</span>
                      </div>

                      <div className="flex items-center space-x-2 text-sm text-gray-600">
                        <span>
                          {item.paymentMethod === "COD" ? "💵" : "💳"}
                        </span>
                        <span>{item.paymentMethod}</span>
                        <span
                          className={`px-2 py-1 rounded-full text-xs font-medium ${
                            item.payment
                              ? "bg-green-100 text-green-800"
                              : "bg-red-100 text-red-800"
                          }`}
                        >
                          {item.payment ? "Paid" : "Pending"}
                        </span>
                      </div>

                      {item.address && (
                        <div className="text-sm text-gray-600">
                          <p className="font-medium">
                            {item.address.firstName} {item.address.lastName}
                          </p>
                          <p>
                            {item.address.city}, {item.address.state}
                          </p>
                          <div className="flex items-center space-x-1 mt-1">
                            <Phone className="w-3 h-3" />
                            <span>{item.address.phone}</span>
                          </div>
                        </div>
                      )}
                    </div>

                    {/* Status & Actions */}
                    <div className="flex flex-col justify-between">
                      {/* Status */}
                      <div className="mb-4">
                        <p className="text-sm text-gray-500 mb-2">
                          Order Status
                        </p>
                        <div className="flex items-center space-x-2">
                          <div
                            className={`w-8 h-8 rounded-full flex items-center justify-center ${statusConfig.color}`}
                          >
                            <StatusIcon className="w-4 h-4 text-white" />
                          </div>
                          <div>
                            <p className="font-medium text-gray-900">
                              {item.status}
                            </p>
                            {item.status === "Delivered" ? (
                              <p className="text-xs text-green-600">
                                Order completed
                              </p>
                            ) : (
                              <p className="text-xs text-gray-500">
                                Est. delivery:{" "}
                                {getEstimatedDelivery(item.status, item.date)}
                              </p>
                            )}
                          </div>
                        </div>

                        {/* Show tracking info if available */}
                        {item.awbCode && (
                          <div className="mt-3 text-xs text-gray-600 bg-orange-50 p-3 rounded">
                            <p className="mb-1">
                              <span className="font-medium">AWB:</span>{" "}
                              {item.awbCode}
                            </p>
                            {item.courierName && (
                              <p>
                                <span className="font-medium">Courier:</span>{" "}
                                {item.courierName}
                              </p>
                            )}
                          </div>
                        )}
                      </div>

                      {/* Action Buttons */}
                      <div className="space-y-2">
                        <button
                          onClick={() => trackShipment(item.orderId)}
                          disabled={trackingLoading}
                          className="w-full flex items-center justify-center space-x-2 bg-red-600 text-white py-2 px-4 rounded-lg text-sm font-medium hover:bg-red-700 transition-colors disabled:opacity-50"
                        >
                          {trackingLoading ? (
                            <>
                              <RefreshCw className="w-4 h-4 animate-spin" />
                              <span>Loading...</span>
                            </>
                          ) : (
                            <>
                              <RotateCcw className="w-4 h-4" />
                              <span>Track Order</span>
                            </>
                          )}
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* Order Summary Footer */}
                  <div className="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center">
                    <div className="text-sm text-gray-600">
                      Total:{" "}
                      <span className="font-semibold text-gray-900">
                        {currency}
                        {(item.price * item.quantity).toFixed(2)}
                      </span>
                    </div>
                    <div className="text-xs text-gray-500">
                      Expected delivery:{" "}
                      {getEstimatedDelivery(item.status, item.date)}
                    </div>
                  </div>

                  {/* Progress Bar for non-delivered orders */}
                  {item.status !== "Delivered" && (
                    <div className="mt-4">
                      <div className="flex justify-between text-xs text-gray-500 mb-2">
                        <span>Order Progress</span>
                        <span>{statusConfig.progress}%</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2">
                        <div
                          className={`h-2 rounded-full transition-all duration-300 ${statusConfig.color}`}
                          style={{ width: `${statusConfig.progress}%` }}
                        />
                      </div>
                    </div>
                  )}
                </div>
              </div>
            );
          })
        )}
      </div>

      {/* Help Section */}
      <div className="px-4 lg:px-0 lg:max-w-6xl lg:mx-auto pb-6">
        <div className="bg-gradient-to-r from-red-50 to-orange-50 rounded-2xl p-6 lg:p-8 border border-red-100">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center">
            <HelpCircle className="w-5 h-5 mr-2 text-red-600" />
            Need Help?
          </h3>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
            <div className="flex items-center space-x-3 bg-white bg-opacity-50 p-4 rounded-lg">
              <Phone className="w-5 h-5 text-red-600" />
              <div>
                <p className="font-medium text-gray-900">Call Support</p>
                <p className="text-gray-600">+91-XXXXX-XXXXX</p>
              </div>
            </div>

            <div className="flex items-center space-x-3 bg-white bg-opacity-50 p-4 rounded-lg">
              <MessageCircle className="w-5 h-5 text-green-600" />
              <div>
                <p className="font-medium text-gray-900">Live Chat</p>
                <p className="text-gray-600">Available 24/7</p>
              </div>
            </div>

            <div className="flex items-center space-x-3 bg-white bg-opacity-50 p-4 rounded-lg">
              <Truck className="w-5 h-5 text-orange-600" />
              <div>
                <p className="font-medium text-gray-900">Free Shipping</p>
                <p className="text-gray-600">On orders ₹999+</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Tracking Modal */}
      {trackingModal && (
        <TrackingModal
          data={trackingModal}
          onClose={() => setTrackingModal(null)}
        />
      )}
    </div>
  );
};

export default Orders;


